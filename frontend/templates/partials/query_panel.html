{% if query and not error and (filters or query.get("Query Image")) %}
    <div class="space-y-3 rounded-2xl border border-slate-200 bg-white px-4 py-3 text-sm">
        {% if filters %}
            <ul class="flex flex-wrap gap-2 text-xs text-slate-500">
                {% for key, value in filters.items() if value %}
                    <li class="rounded-full border border-slate-200 px-3 py-1">{{ key }}: {{ value }}</li>
                {% endfor %}
            </ul>
        {% endif %}
        {% if query.get("Query Image") %}
            <div class="rounded-2xl border border-slate-100 bg-white p-3">
                <p class="text-xs font-semibold uppercase tracking-wide text-slate-400">Query reference</p>
                <div class="mt-3 flex max-h-64 items-center justify-center overflow-hidden rounded-xl border border-slate-100 bg-slate-50">
                    <img
                        src="{{ query['Query Image'] }}"
                        alt="Query reference"
                        class="h-full w-auto object-contain"
                    />
                </div>
            </div>
        {% endif %}
    </div>
{% else %}
    <div class="rounded-2xl border border-dashed border-slate-300 bg-white px-4 py-6 text-sm text-slate-500">
        <p class="font-medium text-slate-600">No query context yet.</p>
        <p class="text-xs mt-1">Run a search or upload an image to see applied filters and the reference preview.</p>
    </div>
{% endif %}

